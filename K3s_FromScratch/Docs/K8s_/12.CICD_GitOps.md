ğŸ“˜ Cours Kubernetes (Upstream) â€” Chapitre 12

ğŸ” CI/CD & GitOps : dÃ©ployer en production de maniÃ¨re fiable

---

ğŸ¯ Objectifs pÃ©dagogiques

Ã€ la fin de ce chapitre, tu sauras :

Pourquoi kubectl en prod est une mauvaise idÃ©e

Comment intÃ©grer Kubernetes dans une chaÃ®ne CI/CD

Comprendre le principe GitOps

DiffÃ©rencier CI/CD â€œclassiqueâ€ et GitOps

---

ğŸ§  1. ProblÃ¨me en production

DÃ©ployer manuellement avec :

kubectl apply -f deployment.yaml

pose plusieurs problÃ¨mes âŒ :

Pas de traÃ§abilitÃ©

Pas de rollback fiable

Risque dâ€™erreur humaine

Pas dâ€™audit

ğŸ‘‰ En production, Git doit Ãªtre la source de vÃ©ritÃ©.

---

ğŸ”„ 2. CI/CD classique avec Kubernetes

ğŸ§± ChaÃ®ne typique

Code â†’ Build image â†’ Tests â†’ Push registry â†’ kubectl apply

Ã‰tapes dÃ©taillÃ©es

1. Commit du code

2) Build image Docker

3. Tests automatisÃ©s

4) Push image dans un registry

5. DÃ©ploiement sur le cluster

ğŸ‘‰ Fonctionne, mais :

Le cluster est pilotÃ© depuis la CI

Lâ€™Ã©tat rÃ©el peut diverger de Git

---

ğŸŒ± 3. Principe GitOps

Le GitOps inverse la logique.

> ğŸ’¡ Le cluster se synchronise automatiquement avec Git.

Git (YAML) â†’ ContrÃ´leur GitOps â†’ Cluster Kubernetes

CaractÃ©ristiques clÃ©s :

Principe Description

Git = source unique de vÃ©ritÃ© SSOT
DÃ©ploiement dÃ©claratif Pas dâ€™action manuelle
RÃ©conciliation continue Auto-correction
Audit & rollback Git history

---

ğŸ¤– 4. Composants GitOps

Composant RÃ´le

Git DÃ©finition de lâ€™Ã©tat
Repo manifests YAML Kubernetes
Agent GitOps Observe Git
Cluster Applique lâ€™Ã©tat dÃ©sirÃ©

Exemples dâ€™outils :

Argo CD

Flux

---

ğŸ§© 5. Exemple de flux GitOps

DÃ©veloppeur
â†“ git commit
Repository Git
â†“
Agent GitOps (dans le cluster)
â†“
kubectl apply (automatique)
â†“
Cluster conforme Ã  Git

---

ğŸ“ 6. Organisation dâ€™un dÃ©pÃ´t GitOps

repo-gitops/
â”œâ”€â”€ apps/
â”‚ â””â”€â”€ web/
â”‚ â”œâ”€â”€ deployment.yaml
â”‚ â”œâ”€â”€ service.yaml
â”‚ â””â”€â”€ ingress.yaml
â”œâ”€â”€ namespaces/
â”‚ â””â”€â”€ prod.yaml
â””â”€â”€ kustomization.yaml

ğŸ‘‰ Aucun accÃ¨s direct au cluster
ğŸ‘‰ Tout passe par Git

---

ğŸ” 7. SÃ©curitÃ© et GitOps

Bonne pratique Pourquoi

AccÃ¨s cluster limitÃ© Pas de kubectl humain
RBAC strict Lâ€™agent GitOps a les droits
SÃ©paration repos Code â‰  manifests
Secrets gÃ©rÃ©s Ã  part SÃ©curitÃ©

---

ğŸ” 8. Rollback en production

Avec GitOps :

git revert <commit>
git push

ğŸ‘‰ Le cluster revient automatiquement Ã  lâ€™Ã©tat prÃ©cÃ©dent.

---

ğŸ“Œ RÃ©sumÃ© du chapitre

Concept ClÃ©

CI/CD classique DÃ©ploiement actif
GitOps RÃ©conciliation passive
Git Source de vÃ©ritÃ©
Agent GitOps Gardien de lâ€™Ã©tat
Rollback Simple et fiable

---

ğŸ“ Ã€ retenir

> En production Kubernetes,
> on ne dÃ©ploie pas avec kubectl,
> on dÃ©ploie avec Git.

---

ğŸ”œ Chapitre suivant

ğŸ“¦ Packaging applicatif avec Helm
ğŸ§© Templates, valeurs, versions
