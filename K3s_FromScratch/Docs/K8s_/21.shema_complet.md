ğŸ—ï¸ Architecture de rÃ©fÃ©rence Kubernetes On-Prem â€” PROD (Mermaid)

flowchart TB
%% =========================
%% UTILISATEURS & PERIMETRE
%% =========================
User[ğŸ‘¤ Utilisateurs<br/>Internet / LAN]
FW[ğŸ”¥ Firewall / Reverse Proxy<br/>Hors cluster]

    %% =========================
    %% LOAD BALANCING & INGRESS
    %% =========================
    LB[âš–ï¸ Load Balancer<br/>VIP / HAProxy]
    IC[ğŸŒ Ingress Controller<br/>NGINX / Traefik]

    %% =========================
    %% KUBERNETES CONTROL PLANE
    %% =========================
    subgraph CP["â˜¸ï¸ Control Plane (HA)"]
        API1[kube-apiserver<br/>CP-1]
        API2[kube-apiserver<br/>CP-2]
        API3[kube-apiserver<br/>CP-3]
        ETCD[(ğŸ§  etcd<br/>Cluster)]
        CM[controller-manager]
        SCH[scheduler]
    end

    %% =========================
    %% WORKER NODES
    %% =========================
    subgraph WK["âš™ï¸ Worker Nodes"]
        subgraph W1["Worker-1"]
            PODA[ğŸ“¦ Pod App A]
            PODB[ğŸ“¦ Pod App B]
        end
        subgraph W2["Worker-2"]
            PODC[ğŸ“¦ Pod App A]
        end
        subgraph W3["Worker-3"]
            PODD[ğŸ“¦ Pod DB]
        end
    end

    %% =========================
    %% SERVICES & NETWORK
    %% =========================
    SVCWEB[ğŸ”Œ Service ClusterIP<br/>App Web]
    SVCDB[ğŸ”Œ Service ClusterIP<br/>DB]

    %% =========================
    %% STORAGE
    %% =========================
    PVCWEB[ğŸ“„ PVC Web]
    PVCDB[ğŸ“„ PVC DB]
    SC[ğŸ“¦ StorageClass]
    CSI[ğŸ”— CSI Driver]
    STOR[ğŸ’¾ Stockage Externe<br/>NFS / SAN / Ceph]

    %% =========================
    %% GITOPS
    %% =========================
    GIT[ğŸ“ Git Repository<br/>Manifests YAML]
    GITOPS[ğŸ¤– GitOps Controller<br/>Argo CD / Flux]

    %% =========================
    %% OBSERVABILITY
    %% =========================
    MON[ğŸ“Š Monitoring<br/>Prometheus / Grafana]
    LOG[ğŸ“œ Logs<br/>Loki / ELK]

    %% =========================
    %% FLOWS
    %% =========================
    User --> FW --> LB --> IC --> SVCWEB
    SVCWEB --> PODA
    SVCWEB --> PODC
    PODA --> SVCDB
    PODC --> SVCDB
    SVCDB --> PODD

    PODA --> PVCWEB
    PODC --> PVCWEB
    PODD --> PVCDB
    PVCWEB --> SC --> CSI --> STOR
    PVCDB --> SC --> CSI --> STOR

    LB --> API1
    LB --> API2
    LB --> API3

    API1 --> ETCD
    API2 --> ETCD
    API3 --> ETCD
    API1 --> CM
    API1 --> SCH

    GIT --> GITOPS --> API1

    PODA --> MON
    PODC --> MON
    PODD --> MON
    PODA --> LOG
    PODC --> LOG
    PODD --> LOG

---

ğŸ§  Comment lire ce schÃ©ma (clÃ© pÃ©dagogique)

ğŸ”¹ Flux utilisateur

Utilisateur â†’ Firewall â†’ Load Balancer â†’ Ingress â†’ Service â†’ Pods

ğŸ”¹ Flux applicatif interne

Pod App â†’ Service DB â†’ Pod DB

ğŸ”¹ Flux stockage (critique)

Pod â†’ PVC â†’ StorageClass â†’ CSI â†’ Stockage externe

ğŸ”¹ Flux GitOps (aucun kubectl humain)

Git â†’ GitOps Controller â†’ API Server â†’ Cluster

ğŸ”¹ Flux contrÃ´le

API Server â†” etcd (Ã©tat du cluster)

---

âœ… Ce schÃ©ma couvre EXPLICITEMENT

âœ” Control Plane HA

âœ” Workers stateless

âœ” Ingress correctement positionnÃ©

âœ” Services (jamais de Pod exposÃ©)

âœ” Stockage externe rÃ©el

âœ” CSI / StorageClass

âœ” GitOps comme SSOT

âœ” ObservabilitÃ©

âœ” SÃ©paration des responsabilitÃ©s

---

ğŸ“Œ RÃ¨gle dâ€™or rappelÃ©e par le schÃ©ma

> Les Pods meurent
> Les Services restent
> Les donnÃ©es vivent ailleurs
> Git commande

---

ğŸ”œ Prochaine Ã©tape (maintenant que le socle est posÃ©)

Dans lâ€™ordre logique et sans mÃ©lange :

1. ğŸ§ª Incidents rÃ©els

Pod en crashloop

PVC bloquÃ©

Ingress KO

2. ğŸ” Zero Trust appliquÃ©

NetworkPolicies complÃ¨tes

Flux autorisÃ©s explicites

3. ğŸ“¦ Helm + GitOps avancÃ©

Charts

Values par environnement

4. ğŸ—ï¸ Architecture HA multi-sites

PRA

Split control plane / storage
