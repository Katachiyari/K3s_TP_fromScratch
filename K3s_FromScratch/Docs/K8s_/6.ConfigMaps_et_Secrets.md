ğŸ“˜ Cours Kubernetes (Upstream) â€” Chapitre 6

âš™ï¸ Configuration des applications : ConfigMaps & Secrets


---

ğŸ¯ Objectifs pÃ©dagogiques

Ã€ la fin de ce chapitre tu sauras :

SÃ©parer configuration et code applicatif

Utiliser un ConfigMap pour les donnÃ©es non sensibles

Utiliser un Secret pour les donnÃ©es sensibles

Injecter ces donnÃ©es dans un Pod (variables dâ€™environnement ou fichiers)

Comprendre les bonnes pratiques de sÃ©curitÃ©



---

ğŸ§  1. Pourquoi externaliser la configuration ?

Dans Kubernetes, une application doit Ãªtre portable et reconfigurable sans reconstruire lâ€™image Docker.

On ne met jamais : âŒ mots de passe
âŒ URLs dâ€™environnement
âŒ clÃ©s API

directement dans lâ€™image du conteneur.

ğŸ‘‰ Kubernetes fournit deux objets dÃ©diÃ©s.


---

ğŸ—‚ï¸ 2. Le ConfigMap

Un ConfigMap stocke des donnÃ©es non sensibles :

Exemple	Type

URL dâ€™API	ParamÃ¨tre
Mode debug	Variable
Fichier de config	Fichier texte


Documentation officielle :
https://kubernetes.io/docs/concepts/configuration/configmap/


---

ğŸ“„ Exemple de ConfigMap

apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_MODE: "production"
  APP_COLOR: "blue"


---

ğŸ”Œ Utiliser un ConfigMap dans un Pod

ğŸ”¹ En variables dâ€™environnement

envFrom:
- configMapRef:
    name: app-config

ğŸ”¹ En fichier montÃ©

volumeMounts:
- name: config-volume
  mountPath: /etc/config

volumes:
- name: config-volume
  configMap:
    name: app-config


---

ğŸ” 3. Le Secret

Un Secret stocke des donnÃ©es sensibles :

Exemple

Mot de passe DB
Token API
ClÃ© privÃ©e
Certificat TLS


Documentation officielle :
https://kubernetes.io/docs/concepts/configuration/secret/

âš ï¸ Les Secrets sont encodÃ©s en base64 (pas chiffrÃ©s par dÃ©faut)


---

ğŸ“„ Exemple de Secret

apiVersion: v1
kind: Secret
metadata:
  name: db-secret
type: Opaque
stringData:
  DB_PASSWORD: "SuperMotDePasse"


---

ğŸ”Œ Utiliser un Secret dans un Pod

ğŸ”¹ En variable dâ€™environnement

env:
- name: DB_PASSWORD
  valueFrom:
    secretKeyRef:
      name: db-secret
      key: DB_PASSWORD

ğŸ”¹ En fichier montÃ©

volumes:
- name: secret-volume
  secret:
    secretName: db-secret


---

ğŸ§ª 4. Mise en application complÃ¨te

ğŸ“ configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-config
data:
  APP_MESSAGE: "Bonjour Kubernetes"


---

ğŸ“ secret.yaml

apiVersion: v1
kind: Secret
metadata:
  name: demo-secret
type: Opaque
stringData:
  APP_PASSWORD: "password123"


---

ğŸ“ deployment.yaml (extrait)

apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo-app
  template:
    metadata:
      labels:
        app: demo-app
    spec:
      containers:
      - name: app
        image: nginx
        envFrom:
        - configMapRef:
            name: demo-config
        env:
        - name: APP_PASSWORD
          valueFrom:
            secretKeyRef:
              name: demo-secret
              key: APP_PASSWORD


---

ğŸš€ DÃ©ploiement

kubectl apply -f configmap.yaml
kubectl apply -f secret.yaml
kubectl apply -f deployment.yaml


---

ğŸ” VÃ©rifier dans le Pod

kubectl exec -it <pod-name> -- env | grep APP


---

ğŸ§  5. Bonnes pratiques

Bonne pratique	Pourquoi

Ne pas stocker de secrets dans Git	SÃ©curitÃ©
Utiliser RBAC	Limiter lâ€™accÃ¨s aux Secrets
Activer chiffrement etcd	SÃ©curiser le stockage
Utiliser un gestionnaire externe (Vault)	SÃ©curitÃ© avancÃ©e



---

ğŸ“Œ RÃ©sumÃ© du chapitre

Objet	Usage

ConfigMap	DonnÃ©es non sensibles
Secret	DonnÃ©es sensibles
Injection	Variables ou fichiers
But	SÃ©parer config et code



---

ğŸ“ Ã€ retenir

> Une image Docker doit Ãªtre gÃ©nÃ©rique.
La configuration est fournie par Kubernetes.




---

ğŸ”œ Chapitre suivant

ğŸ’¾ Stockage persistant (Volumes, PV, PVC)
