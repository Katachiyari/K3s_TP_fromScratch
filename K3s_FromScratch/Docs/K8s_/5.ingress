ğŸ“˜ Cours Kubernetes (Upstream) â€” Chapitre 5

ğŸŒ Exposer les applications HTTP : Ingress

> ContinuitÃ© logique : aprÃ¨s Pods â†’ Deployments â†’ Services, on ajoute maintenant une couche L7 (HTTP/HTTPS) au-dessus des Services.




---

ğŸ¯ Objectifs pÃ©dagogiques

Ã€ la fin de ce chapitre tu sauras :

DiffÃ©rence entre Service et Ingress

RÃ´le dâ€™un Ingress Controller

Router le trafic HTTP par host et path

Configurer le TLS

Diagnostiquer un Ingress qui ne fonctionne pas



---

ğŸ§  1. Pourquoi Ingress existe ?

Un Service fonctionne en couche L4 (TCP/UDP).
Il ne comprend pas HTTP.

ProblÃ¨me :

Tu veux exposer plusieurs applications web

Tu ne veux pas ouvrir un port NodePort par application

Tu veux faire du routage par nom de domaine


ğŸ‘‰ Solution : Ingress


---

ğŸ”€ 2. Architecture Ingress

Client HTTP
     â†“
Ingress Controller (reverse proxy)
     â†“
Ingress rules (host/path)
     â†“
Service
     â†“
Pods

ğŸ“Œ Ingress ne remplace pas Service
ğŸ“Œ Il route vers un Service

Documentation officielle : Kubernetes â€“ Ingress Concept
https://kubernetes.io/docs/concepts/services-networking/ingress/


---

âš™ï¸ 3. Lâ€™Ingress Controller (obligatoire)

Un Ingress seul ne fait rien.
Il faut un Ingress Controller qui implÃ©mente les rÃ¨gles.

Exemples populaires :

Controller	Technologie

NGINX Ingress	NGINX
Traefik	Traefik proxy
HAProxy Ingress	HAProxy


Sans controller â†’ Ingress ignorÃ©.


---

ğŸ“„ 4. Structure dâ€™un Ingress

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: web-ingress
spec:
  rules:
  - host: app.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-service
            port:
              number: 80


---

ğŸŒ 5. Routage par Host

Tu peux router selon le domaine :

Host	Destination

app.example.com	Service web
api.example.com	Service api


Exemple :

rules:
- host: api.example.com
  http:
    paths:
    - path: /
      pathType: Prefix
      backend:
        service:
          name: api-service
          port:
            number: 80


---

ğŸ›£ï¸ 6. Routage par Path

Permet de partager un domaine :

URL	Service

example.com/api	api-service
example.com/app	web-service


paths:
- path: /api
  pathType: Prefix
  backend:
    service:
      name: api-service
      port:
        number: 80


---

ğŸ”’ 7. TLS avec Ingress

On peut activer HTTPS :

tls:
- hosts:
  - app.example.com
  secretName: app-tls

Le secret doit contenir :

certificat

clÃ© privÃ©e


kubectl create secret tls app-tls \
  --cert=cert.pem \
  --key=key.pem


---

ğŸ§ª 8. Mise en application complÃ¨te

Ã‰tape 1 â€” Namespace

kubectl create namespace demo-ingress


---

Ã‰tape 2 â€” DÃ©ploiement dâ€™une app

kubectl -n demo-ingress create deploy web --image=nginx
kubectl -n demo-ingress expose deploy web --port=80 --name=web-service


---

Ã‰tape 3 â€” CrÃ©er lâ€™Ingress

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: web-ingress
  namespace: demo-ingress
spec:
  rules:
  - host: web.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-service
            port:
              number: 80

kubectl apply -f ingress.yaml


---

Ã‰tape 4 â€” VÃ©rification

kubectl get ingress -n demo-ingress
kubectl describe ingress web-ingress -n demo-ingress


---

ğŸ§  9. Points clÃ©s dâ€™architecture

Ã‰lÃ©ment	RÃ´le

Service	L4 vers Pods
Ingress	L7 HTTP routing
Ingress Controller	Reverse proxy
TLS Secret	Certificat HTTPS



---

ğŸ§© 10. DÃ©pannage Ingress

ğŸ” Lâ€™Ingress nâ€™a pas dâ€™IP ?

kubectl get svc -A | grep ingress

ğŸ” Controller absent ?

kubectl get pods -A | grep ingress

ğŸ” Mauvais service ciblÃ© ?

kubectl describe ingress <name>
kubectl get svc
kubectl get endpoints


---

ğŸ“Œ RÃ©sumÃ© du chapitre

Avant	AprÃ¨s

Service	AccÃ¨s rÃ©seau basique
Ingress	Routage HTTP avancÃ©
NodePort	AccÃ¨s simple
Ingress	Multi-applications, TLS, virtual hosts



---

ğŸ“ Ã€ retenir

> Service = connexion rÃ©seau
Ingress = routage web intelligent



Ingress est la porte dâ€™entrÃ©e HTTP moderne des applications Kubernetes.


---

ğŸ”œ Prochain chapitre

ğŸ” ConfigMaps & Secrets
âš™ï¸ Gestion de la configuration des applications
