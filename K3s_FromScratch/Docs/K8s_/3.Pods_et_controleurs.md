Parfait ğŸ‘ â€” tu as raison, on passe en niveau cours magistral dÃ©taillÃ©.
On garde la logique du livre + doc officielle, mais avec plus de profondeur technique.


---

ğŸ“˜ Cours Kubernetes â€” Chapitre 4

ğŸŒ RÃ©seau Kubernetes et objet Service


---

ğŸ¯ Objectifs pÃ©dagogiques

Ã€ la fin de ce chapitre, tu devras comprendre :

Le modÃ¨le rÃ©seau Kubernetes

Pourquoi les Pods ne sont pas des points dâ€™accÃ¨s fiables

Le rÃ´le exact dâ€™un Service

Comment Kubernetes fait le load balancing

Les types de Services et leurs cas dâ€™usage

Le rÃ´le de kube-proxy et des Endpoints



---

ğŸ§© 1. Le modÃ¨le rÃ©seau de Kubernetes

Kubernetes impose un modÃ¨le rÃ©seau universel et plat :

Principe	Explication

Chaque Pod a une IP unique	Pas dâ€™IP partagÃ©e entre Pods
Pas de NAT entre Pods	Communication directe
Tous les Pods peuvent se joindre	MÃªme entre nÅ“uds
Le rÃ©seau est fourni par un plugin CNI	Kubernetes ne gÃ¨re pas le rÃ©seau lui-mÃªme


ğŸ‘‰ Ce modÃ¨le simplifie Ã©normÃ©ment la communication entre microservices.


---

ğŸ§  Pourquoi ce modÃ¨le est puissant ?

Dans Kubernetes :

Une application = plusieurs Pods

Les Pods peuvent Ãªtre dÃ©placÃ©s dâ€™un nÅ“ud Ã  lâ€™autre

Le rÃ©seau doit donc Ãªtre indÃ©pendant des machines physiques



---

âš ï¸ 2. ProblÃ¨me : les Pods sont Ã©phÃ©mÃ¨res

Un Pod peut Ãªtre :

recrÃ©Ã©

dÃ©placÃ©

supprimÃ©


â¡ Son IP change
â¡ Les autres applications ne peuvent pas sâ€™y fier

Câ€™est lÃ  quâ€™intervient le Service.


---

ğŸ”Œ 3. Le Service : abstraction rÃ©seau stable

Un Service est un objet Kubernetes qui fournit :

Ã‰lÃ©ment	RÃ´le

Une IP virtuelle stable	Appelable en permanence
Un nom DNS	RÃ©solution automatique
Une liste dynamique de Pods	BasÃ©e sur des labels
Du load balancing	RÃ©partition du trafic



---

ğŸ§  Fonctionnement interne

Client â†’ Service â†’ kube-proxy â†’ Pod 1 / Pod 2 / Pod 3

Le Service ne parle pas directement aux Pods
Câ€™est kube-proxy qui configure les rÃ¨gles rÃ©seau (iptables/IPVS)


---

ğŸ§¬ 4. SÃ©lection des Pods : les labels

Un Service ne connaÃ®t pas les Pods par leur nom.

Il utilise un sÃ©lecteur de labels :

selector:
  app: web

Tous les Pods ayant app=web recevront le trafic.


---

ğŸ“ 5. Endpoints : les Pods rÃ©ellement ciblÃ©s

Kubernetes maintient un objet Endpoints pour chaque Service.

Voir les Pods associÃ©s :

kubectl get endpoints

ğŸ‘‰ Si un Pod meurt â†’ il disparaÃ®t des endpoints
ğŸ‘‰ Le Service arrÃªte de lui envoyer du trafic


---

ğŸ”„ 6. Load Balancing

Le Service distribue les requÃªtes :

en mode round-robin (iptables)

ou via IPVS (plus performant)


Chaque requÃªte peut aller vers un Pod diffÃ©rent.


---

âš–ï¸ 7. Les types de Services

ğŸ§± ClusterIP (par dÃ©faut)

Usage	Communication interne uniquement

IP	Virtuelle, interne au cluster


Câ€™est le mode standard pour les microservices.


---

ğŸŒ NodePort

Expose un port sur chaque nÅ“ud :

IP_NODE:PORT_NODE

Utile pour tests ou accÃ¨s simple sans Ingress.


---

â˜ï¸ LoadBalancer

UtilisÃ© en cloud :

Provisionne un load balancer externe

Associe une IP publique



---

ğŸ”— ExternalName

Fait pointer un Service vers un DNS externe :

type: ExternalName
externalName: api.externe.com


---

ğŸŒ 8. DNS interne Kubernetes

Chaque Service obtient un nom DNS :

service.namespace.svc.cluster.local

Exemple :

web-service.default.svc.cluster.local

Les applications utilisent ce nom â†’ pas dâ€™IP en dur.


---

ğŸ§  9. kube-proxy : le moteur rÃ©seau

kube-proxy sâ€™exÃ©cute sur chaque nÅ“ud et :

Surveille les Services et Endpoints

Configure les rÃ¨gles iptables ou IPVS

Redirige le trafic vers les bons Pods


Sans kube-proxy â†’ pas de routage vers les Services.


---

ğŸ§ª 10. Tester un Service

Lister les services :

kubectl get svc

Voir les Pods associÃ©s :

kubectl get endpoints

Tester la rÃ©solution DNS dans un Pod :

kubectl exec -it pod-client -- curl http://web-service


---

ğŸ“Œ RÃ©sumÃ© du chapitre

Concept	RÃ´le

Pod	IP Ã©phÃ©mÃ¨re
Service	Point dâ€™accÃ¨s stable
Labels	SÃ©lection des Pods
Endpoints	Liste rÃ©elle des Pods
kube-proxy	Routage rÃ©seau
ClusterIP	Communication interne
NodePort	AccÃ¨s externe simple
LoadBalancer	AccÃ¨s externe cloud



---

ğŸ“ Ã€ retenir

> Les Pods changent.
Les Services restent.
Kubernetes gÃ¨re automatiquement la correspondance entre les deux.




---

ğŸ”œ Chapitre suivant

ğŸŒ Exposition HTTP avancÃ©e
ğŸ”€ Introduction aux Ingress
ğŸ§­ Routage applicatif (Host, Path, TLS)
