ğŸ“˜ Cours Kubernetes (Upstream) â€” Chapitre 9

ğŸ“Š Supervision, mÃ©triques et autoscaling

---

ğŸ¯ Objectifs pÃ©dagogiques

Ã€ la fin de ce chapitre, tu comprendras :

Comment Kubernetes surveille les ressources

Le rÃ´le du Metrics Server

Comment fonctionne lâ€™autoscaling horizontal (HPA)

Les bases de lâ€™observabilitÃ© dâ€™un cluster

---

ğŸ§  1. Pourquoi la supervision est essentielle

Dans un cluster Kubernetes :

Les Pods peuvent varier en charge

Les ressources CPU / RAM sont limitÃ©es

Une application peut devenir lente ou tomber

ğŸ‘‰ Il faut mesurer pour pouvoir rÃ©agir

---

âš™ï¸ 2. Le Metrics Server

Le Metrics Server collecte les mÃ©triques de base :

Mesure Description

CPU Utilisation des conteneurs
MÃ©moire Consommation RAM

Commande :

kubectl top nodes
kubectl top pods

Documentation officielle :
https://kubernetes.io/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/

---

ğŸ“ˆ 3. Lâ€™Horizontal Pod Autoscaler (HPA)

Le HPA ajuste automatiquement le nombre de Pods en fonction de la charge.

Fonctionnement :

Charge â†‘ â†’ Pods â†‘  
Charge â†“ â†’ Pods â†“

---

ğŸ§ª Exemple de HPA

kubectl autoscale deployment demo-web \
 --cpu-percent=50 \
 --min=2 \
 --max=5

Cela signifie :

Si CPU moyen > 50% â†’ nouveaux Pods

Si CPU < 50% â†’ rÃ©duction

---

ğŸ“„ YAML Ã©quivalent

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
name: demo-hpa
spec:
scaleTargetRef:
apiVersion: apps/v1
kind: Deployment
name: demo-web
minReplicas: 2
maxReplicas: 5
metrics:

* type: Resource
  resource:
  name: cpu
  target:
  type: Utilization
  averageUtilization: 50

---

ğŸ§  4. PrÃ©requis pour HPA

Ton Deployment doit dÃ©finir :

resources:
requests:
cpu: "100m"
limits:
cpu: "500m"

Sans requests CPU â†’ HPA ne fonctionne pas.

---

ğŸ” 5. VÃ©rifier lâ€™autoscaling

kubectl get hpa
kubectl describe hpa demo-hpa

---

ğŸ“Š 6. Supervision avancÃ©e (au-delÃ  de Kubernetes de base)

Outil RÃ´le

Prometheus Collecte mÃ©triques dÃ©taillÃ©es
Grafana Visualisation
Alertmanager Alertes
Loki / ELK Logs

Kubernetes fournit la base, mais la supervision complÃ¨te repose sur ces outils.

---

ğŸ§© 7. ObservabilitÃ© = 3 piliers

Pilier Outil

MÃ©triques Prometheus
Logs Loki / ELK
Traces Jaeger / Tempo

---

ğŸ“Œ RÃ©sumÃ© du chapitre

Ã‰lÃ©ment RÃ´le

Metrics Server Mesures CPU/RAM
kubectl top Visualiser les ressources
HPA Autoscaling des Pods
Requests/Limits Base de lâ€™autoscaling

---

ğŸ“ Ã€ retenir

> Kubernetes peut adapter automatiquement le nombre de Pods,
> mais seulement si les ressources sont correctement dÃ©finies.

---

ğŸ”œ Chapitre suivant

ğŸ” SÃ©curitÃ© Kubernetes (RBAC, namespaces, policies)
