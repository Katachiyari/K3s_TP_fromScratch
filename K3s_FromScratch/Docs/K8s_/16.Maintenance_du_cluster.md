ğŸ“˜ Cours Kubernetes (Upstream) â€” Chapitre 16

ğŸ§° Maintenance du cluster & cycle de vie (Upgrades, sauvegardes, PRA)

---

ğŸ¯ Objectifs pÃ©dagogiques

Ã€ la fin de ce chapitre, tu sauras :

Comment mettre Ã  jour un cluster Kubernetes en production

Ce qui doit Ãªtre sauvegardÃ© (et ce qui ne sert Ã  rien)

Concevoir une stratÃ©gie de PRA / Disaster Recovery

RÃ©duire le risque opÃ©rationnel lors des opÃ©rations sensibles

---

ğŸ§  1. Principe fondamental dâ€™exploitation

Un cluster Kubernetes vit :

nouvelles versions Kubernetes

mises Ã  jour OS

correctifs de sÃ©curitÃ©

Ã©volutions applicatives

ğŸ‘‰ La maintenance fait partie du design du cluster.

---

ğŸ” 2. Mise Ã  jour Kubernetes (Upgrade)

ğŸ§© Composants Ã  mettre Ã  jour

Ã‰lÃ©ment PrioritÃ©

Control Plane Critique
etcd Critique
kubelet Ã‰levÃ©e
kube-proxy Ã‰levÃ©e
CNI / CSI VÃ©rifier compatibilitÃ©

---

âš™ï¸ 3. StratÃ©gie dâ€™upgrade recommandÃ©e

Ordre obligatoire

1. Control Plane

2) Workers (un par un)

3. Add-ons (Ingress, monitoring, etc.)

ğŸ‘‰ Jamais lâ€™inverse.

---

ğŸ§ª ProcÃ©dure type (kubeadm)

Drain dâ€™un nÅ“ud worker

kubectl drain node-1 --ignore-daemonsets --delete-emptydir-data

Mise Ã  jour du nÅ“ud

OS

kubelet / kubeadm

Remise en service

kubectl uncordon node-1

---

ğŸ§  4. Pourquoi le drain est essentiel

Le drain :

Ã©vacue les Pods proprement

respecte les PodDisruptionBudgets

Ã©vite les coupures applicatives

Sans drain â†’ risque dâ€™interruption.

---

ğŸ’¾ 5. Sauvegardes : que faut-il vraiment sauvegarder ?

ğŸ¯ PrioritÃ© absolue : etcd

etcd contient :

manifests Kubernetes

Secrets

ConfigMaps

Ã©tat du cluster

ğŸ‘‰ Sans etcd = cluster perdu.

---

ğŸ“¦ Sauvegarde etcd (exemple conceptuel)

ETCDCTL_API=3 etcdctl snapshot save snapshot.db

Bonnes pratiques :

sauvegarde rÃ©guliÃ¨re

stockage externe

test de restauration

---

ğŸ—„ï¸ 6. DonnÃ©es applicatives

Ã€ sauvegarder en plus :

volumes persistants (PV)

bases de donnÃ©es

fichiers applicatifs

ğŸ‘‰ Kubernetes nâ€™est pas une solution de backup.

---

ğŸ§¯ 7. Disaster Recovery (PRA)

ScÃ©narios Ã  couvrir

ScÃ©nario Impact

Perte dâ€™un worker Faible
Perte du control plane Ã‰levÃ©
Corruption etcd Critique
Perte du stockage Critique

---

ğŸ§  StratÃ©gie PRA type

Sauvegarde etcd + PV

ProcÃ©dure documentÃ©e

Environnement de reprise

Tests rÃ©guliers

---

ğŸ” 8. SÃ©curitÃ© pendant la maintenance

RÃ¨gle Pourquoi

AccÃ¨s restreint Ã‰viter erreurs
FenÃªtre de maintenance Communication
Rollback prÃªt RÃ©versibilitÃ©
Logs & audit TraÃ§abilitÃ©

---

ğŸ“Œ RÃ©sumÃ© du chapitre

Domaine ClÃ©

Upgrade Progressif et contrÃ´lÃ©
Drain Indispensable
Sauvegarde etcd + donnÃ©es
PRA TestÃ©, documentÃ©
Objectif ContinuitÃ© de service

---

ğŸ“ Ã€ retenir

> Un cluster Kubernetes nâ€™est jamais figÃ©.
> La maintenance fait partie intÃ©grante de sa fiabilitÃ©.

---

ğŸ”œ Chapitre suivant

ğŸ§© Kubernetes au-delÃ  des bases
â¡ï¸ Service Mesh
â¡ï¸ eBPF
â¡ï¸ Ã‰volutions de lâ€™Ã©cosystÃ¨me
